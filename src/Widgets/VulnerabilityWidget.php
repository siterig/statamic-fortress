<?php

namespace Siterig\Fortress\Widgets;

use Statamic\Widgets\Widget;
use Siterig\Fortress\Security\VulnerabilityScanner;
use Illuminate\Support\Facades\Cache;

class VulnerabilityWidget extends Widget
{
    protected $config = [
        'title' => 'Package Vulnerabilities',
        'refresh_interval' => 3600 // 1 hour
    ];

    public function html()
    {
        $scanner = new VulnerabilityScanner();
        $results = $scanner->scan();

        return view('fortress::widgets.vulnerability', compact('results'));
    }

    protected function getVulnerabilities()
    {
        return Cache::remember('fortress:vulnerabilities', $this->config('refresh_interval'), function () {
            $scanner = app(VulnerabilityScanner::class);
            return $scanner->scan();
        });
    }

    public function getSeverityClass($severity)
    {
        return match (strtolower($severity)) {
            'critical' => 'text-red-600',
            'high' => 'text-orange-600',
            'medium' => 'text-yellow-600',
            'low' => 'text-blue-600',
            default => 'text-gray-600'
        };
    }
} 
 